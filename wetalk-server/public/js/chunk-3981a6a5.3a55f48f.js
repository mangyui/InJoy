(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3981a6a5"],{"38dc":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"talk-room"},[a("van-nav-bar",{attrs:{fixed:"",title:"世界频道("+e.myTalk.numberP+")","left-arrow":""},on:{"click-left":function(t){return e.$store.commit("GOBACK")}}},[a("van-icon",{attrs:{slot:"right",name:"weapp-nav"},slot:"right"})],1),a("div",{staticClass:"content-wrap"},[a("van-notice-bar",{attrs:{text:"该聊天室内，所有都可见","left-icon":"volume-o",mode:"closeable"}}),a("div",{staticClass:"mess-box",style:{paddingBottom:0!=e.isMore?"160px":"55px"}},[a("div",{staticClass:"mess-list"},e._l(e.msgList,function(t,n){return a("div",{key:n,staticClass:"list-item"},[1==t.type&&t.user.id!=e.user.id?a("div",{staticClass:"mess-item"},[a("div",{staticClass:"mu-avatar"},[a("img",{attrs:{src:t.user.avatar}}),a("img",{staticClass:"icon-sex",attrs:{src:1==t.user.sex?s("48ef"):s("b9bf")}})]),a("div",{staticClass:"mess-item-right"},[a("span",[e._v(e._s(t.user.name))]),a("p",{staticClass:"mess-item-content"},[e._v(e._s(t.content))]),a("p",{staticClass:"mess-item-time"},[e._v(e._s(t.time))])])]):1==t.type&&t.user.id==e.user.id?a("div",{staticClass:"mess-item-me"},[a("div",{staticClass:"mu-avatar"},[a("img",{attrs:{src:e.user.avatar}}),a("img",{staticClass:"icon-sex",attrs:{src:1==e.user.sex?s("48ef"):s("b9bf")}})]),a("div",{staticClass:"mess-item-right"},[a("span",[e._v(e._s(e.user.name))]),a("p",{staticClass:"mess-item-content",on:{touchstart:function(t){return e.gtouchstart(n)},touchend:e.gtouchend}},[e._v(e._s(t.content))]),a("p",{staticClass:"mess-item-time"},[e._v(e._s(t.time))])])]):a("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowInOut,expression:"isShowInOut"}],staticClass:"mess-system"},[e._v("\n            "+e._s(t.content)+"\n          ")])])}),0)])],1),a("InputBox",{on:{changeMore:e.changeMore,toSend:e.toSend}}),a("van-action-sheet",{attrs:{actions:e.actions,"cancel-text":"取消"},on:{select:e.onSelect,cancel:function(t){e.showMore=!1}},model:{value:e.showMore,callback:function(t){e.showMore=t},expression:"showMore"}})],1)},n=[],i=(s("7f7f"),s("d225")),o=s("b0b4"),c=s("308d"),r=s("6bb5"),u=s("4e2b"),l=s("9ab4"),m=s("60a3"),v=s("4bb5"),d=(s("a481"),s("2b0e")),h=s("0613"),f=s("086a"),p=function(){function e(t,s){Object(i["a"])(this,e),this.isOver=!1,this.ws=new WebSocket("ws://47.106.130.141:9612"),this.user=t,this.numberP=s}return Object(o["a"])(e,[{key:"creatSending",value:function(e,t){var s=new Date(+new Date+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,""),a=new f["a"](s,e,t,1===t?this.user:null),n={message:a};this.ws.send(JSON.stringify(n))}},{key:"createWebsocket",value:function(){var e=this;this.ws.onopen=function(t){e.creatSending(e.user.name+" 进入聊天室",0)},this.ws.onmessage=function(t){var s=JSON.parse(t.data);s.isRemove?h["a"].commit("removeMsg",s.message):h["a"].commit("addMsg",s.message),-1===s.message.type?e.numberP=s.number-1:e.numberP=s.number,d["a"].nextTick(function(){e.scrollBottom()})}}},{key:"backoutMess",value:function(e){var t={message:e,isRemove:!0};this.ws.send(JSON.stringify(t))}},{key:"scrollBottom",value:function(){var e=this;try{var t=document.querySelector(".mess-list .list-item:last-child");t&&(this.isOver?t.scrollIntoView():setTimeout(function(){e.isOver=!0,t.scrollIntoView()},300))}catch(s){console.error(s)}}}]),e}(),b=p,w=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"talk-bottom"},[s("div",{staticClass:"talk-send"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.sendText,expression:"sendText"}],staticClass:"input-mess",attrs:{rows:"1",name:"text"},domProps:{value:e.sendText},on:{input:function(t){t.target.composing||(e.sendText=t.target.value)}}}),s("van-icon",{staticClass:"input-icon",attrs:{name:"smile-o"},on:{click:function(t){e.isMore=2!=e.isMore?2:0}}}),s("van-button",{directives:[{name:"show",rawName:"v-show",value:""!=e.sendText,expression:"sendText!=''"}],attrs:{type:"danger"},on:{click:e.toSend}},[e._v("发送")]),s("van-icon",{directives:[{name:"show",rawName:"v-show",value:""==e.sendText,expression:"sendText==''"}],staticClass:"input-icon",attrs:{name:"add-o"},on:{click:function(t){e.isMore=1!=e.isMore?1:0}}})],1),s("div",{directives:[{name:"show",rawName:"v-show",value:2==e.isMore,expression:"isMore==2"}],staticClass:"add-more"},[s("div")]),s("div",{directives:[{name:"show",rawName:"v-show",value:1==e.isMore,expression:"isMore==1"}],staticClass:"add-more"},[s("div",[s("van-icon",{staticClass:"input-icon",attrs:{name:"photo",color:"#1989fa"}}),s("p",[e._v("图片")])],1),s("div",[s("van-icon",{staticClass:"input-icon",attrs:{name:"volume",color:"#f44"}}),s("p",[e._v("语音")])],1)])])},g=[],k=function(e){function t(){var e;return Object(i["a"])(this,t),e=Object(c["a"])(this,Object(r["a"])(t).apply(this,arguments)),e.sendText="",e.isMore=0,e}return Object(u["a"])(t,e),Object(o["a"])(t,[{key:"changeAge",value:function(e,t){this.$emit("changeMore",this.isMore)}},{key:"toSend",value:function(){""!==this.sendText&&(this.$emit("toSend",this.sendText),this.sendText="")}}]),t}(m["c"]);l["a"]([Object(m["d"])("isMore")],k.prototype,"changeAge",null),k=l["a"]([m["a"]],k);var x=k,y=x,M=(s("e149"),s("2877")),O=Object(M["a"])(y,w,g,!1,null,"fbbe2080",null),C=O.exports,T=function(e){function t(){var e;return Object(i["a"])(this,t),e=Object(c["a"])(this,Object(r["a"])(t).apply(this,arguments)),e.isMore=0,e.mIndex=-1,e.showMore=!1,e.actions=[{name:"复制"},{name:"撤回"}],e}return Object(u["a"])(t,e),Object(o["a"])(t,[{key:"changeMore",value:function(e){this.isMore=e}},{key:"backMess",value:function(e){this.myTalk.backoutMess(this.msgList[e])}},{key:"toSend",value:function(e){""!==e&&this.myTalk.creatSending(e,1)}},{key:"gtouchstart",value:function(e){var t=this;this.timeOutEvent=setTimeout(function(){t.showMore=!0,t.mIndex=e},666)}},{key:"gtouchend",value:function(){clearTimeout(this.timeOutEvent)}},{key:"onSelect",value:function(e,t){1===t&&this.backMess(this.mIndex),this.showMore=!1}},{key:"created",value:function(){this.myTalk=new b(this.user,0),this.myTalk.createWebsocket()}},{key:"beforeDestroy",value:function(){this.myTalk.creatSending(this.user.name+" 退出聊天室",-1),this.myTalk.ws.close()}}]),t}(m["c"]);l["a"]([v["a"]],T.prototype,"user",void 0),l["a"]([v["a"]],T.prototype,"msgList",void 0),l["a"]([v["a"]],T.prototype,"isShowInOut",void 0),T=l["a"]([Object(m["a"])({components:{InputBox:C}})],T);var S=T,_=S,j=Object(M["a"])(_,a,n,!1,null,null,null);t["default"]=j.exports},"48ef":function(e,t,s){e.exports=s.p+"img/male.960485f7.svg"},"5bf4":function(e,t,s){},b9bf:function(e,t,s){e.exports=s.p+"img/female.88866ba0.svg"},e149:function(e,t,s){"use strict";var a=s("5bf4"),n=s.n(a);n.a}}]);